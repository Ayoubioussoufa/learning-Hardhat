<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/Tournament.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> Tournament.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">84% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>21/25</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>6/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">60% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>3/5</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">82.05% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>32/39</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.27;
&nbsp;
contract LocalTournament {
    event tournamentCreated();
    uint8 MATCHPERTOURNAMENT = 3;
    // Structure to represent each match
    struct Match {
        uint matchId;
        string player1; // name
        string player2; // name
        uint player1Score;
        uint player2Score;
        string winner; // Winner's name
    }
&nbsp;
    // Structure to represent each tournament
    struct Tournament {
        uint tournamentId;
        Match[3] matches; // List of matches in the tournament
        uint currentMatchCount; // Keep track of how many matches have been added
    }
&nbsp;
    // Player cumulative stats across tournaments
    struct PlayerStats {
        uint totalWins;
        uint totalLosses;
        uint totalScore;
    }
&nbsp;
    // Mapping of player's name to their cumulative stats
    mapping(string =&gt; PlayerStats) public playerStats;
&nbsp;
    // Mapping of tournament ID to tournament details
    mapping(uint =&gt; Tournament) public tournaments;
&nbsp;
    // Counter to track tournament IDs
    uint8 public tournamentCounter;
&nbsp;
    /**
     * @notice Creates a new tournament.
     */
    function createTournament() public {
        Tournament storage tournament = tournaments[tournamentCounter]; // SLOAD once
        tournament.tournamentId = tournamentCounter++;
        tournament.currentMatchCount = 0;
&nbsp;
        emit tournamentCreated();
    }
&nbsp;
    /**
     * @notice Records the result of a match in a tournament.
     * @param _tournamentId The ID of the tournament.
     * @param _player1 The name of player 1.
     * @param _player2 The name of player 2.
     * @param _player1Score The score of player 1.
     * @param _player2Score The score of player 2.
     */
    function recordMatch(
        uint _tournamentId,
        string memory _player1,
        string memory _player2,
        uint _player1Score,
        uint _player2Score
    ) public {
        Tournament storage tournament = tournaments[_tournamentId];
        PlayerStats storage playerStates1 = playerStats[_player1];
        PlayerStats storage playerStates2 = playerStats[_player2];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            _tournamentId &gt;= 0 &amp;&amp; _tournamentId &lt;= tournamentCounter,
            "Invalid tournament ID"
        );
        <span class="missing-if-branch" title="else path not taken" >E</span>require(
            tournament.currentMatchCount &lt; MATCHPERTOURNAMENT,
            "Maximum matches reached"
        );
&nbsp;
        // Determine the winner
        string memory _winner;
        <span class="missing-if-branch" title="if path not taken" >I</span>if (_player1Score &gt; _player2Score) {
            _winner = _player1;
            playerStates1.totalWins++;
            playerStates2.totalLosses++;
        } else {
            _winner = _player2;
            playerStates2.totalWins++;
            playerStates1.totalLosses++;
        }
&nbsp;
        // Update cumulative scores
        playerStates1.totalScore += _player1Score;
        playerStates2.totalScore += _player2Score;
&nbsp;
        // Create a new match
        Match memory newMatch = Match({
            matchId: tournament.currentMatchCount,
            player1: _player1,
            player2: _player2,
            player1Score: _player1Score,
            player2Score: _player2Score,
            winner: _winner
        });
&nbsp;
        // Add the match to the tournament
        tournament.matches[
            tournament.currentMatchCount
        ] = newMatch;
        tournament.currentMatchCount++;
    }
&nbsp;
    /**
     * @notice Returns all matches in a tournament.
     * @param _tournamentId The ID of the tournament.
     * @return An array of matches.
     */
<span class="fstat-no" title="function not covered" >    function getTournamentMatches(</span>
        uint _tournamentId
    ) public view returns (Match[3] memory) {
<span class="cstat-no" title="statement not covered" >        require(</span>
            _tournamentId &gt;= 0 &amp;&amp; _tournamentId &lt;= tournamentCounter,
            "Invalid tournament ID"
        );
<span class="cstat-no" title="statement not covered" >        return tournaments[_tournamentId].matches;</span>
    }
&nbsp;
    /**
     * @notice Returns the cumulative stats of a player.
     * @param _playerId The name of the player.
     * @return The player's total wins, total losses, and total score.
     */
<span class="fstat-no" title="function not covered" >    function getPlayerStats(</span>
        string memory _playerId
    ) public view returns (uint, uint, uint) {
<span class="cstat-no" title="statement not covered" >        PlayerStats memory stats = playerStats[_playerId];</span>
<span class="cstat-no" title="statement not covered" >        return (stats.totalWins, stats.totalLosses, stats.totalScore);</span>
    }
&nbsp;
    /**
     * @notice Returns all matches a player participated in.
     * @param _name The name of the player.
     * @return An array of matches the player participated in.
     */
    function getAllMatchesPlayedByThePlayer(
        string memory _name
    ) public view returns (Match[] memory) {
        // Calculate maximum possible matches
        uint8 maxMatches = tournamentCounter * MATCHPERTOURNAMENT; // Maximum matches a player could play
        Match[] memory allMatches = new Match[](maxMatches);
        uint8 matchCount = 0; // Count of matches the player participated in
&nbsp;
        // Cache the hash of the player's name to avoid recalculating it
        bytes32 playerHash = keccak256(abi.encodePacked(_name));
&nbsp;
        // Loop through all tournaments
        for (uint8 counter = 0; counter &lt;= tournamentCounter; counter++) {
            Tournament storage tournament = tournaments[counter];
            // Loop through the 3 matches in each tournament
            for (
                uint8 cMatches = 0;
                cMatches &lt; MATCHPERTOURNAMENT;
                cMatches++
            ) {
                // Check if the player participated in the match
                if (
                    playerHash ==
                    keccak256(
                        abi.encodePacked(
                            tournament.matches[cMatches].player1
                        )
                    ) ||
<span class="branch-1 cbranch-no" title="branch not covered" >                    playerHash ==</span>
                    keccak256(
                        abi.encodePacked(
                            tournament.matches[cMatches].player2
                        )
                    )
                ) {
                    // Store the match in the array
                    allMatches[matchCount++] = tournament.matches[cMatches];
                }
            }
        }
&nbsp;
        // Create a new array to return only the relevant matches
        Match[] memory playerMatches = new Match[](matchCount);
        for (uint8 i = 0; i &lt; matchCount; i++) {
            playerMatches[i] = allMatches[i];
        }
&nbsp;
        return playerMatches; // Return the array of matches
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Oct 01 2024 19:02:56 GMT+0100 (GMT+01:00)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
